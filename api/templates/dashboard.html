<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard - Einkaufsliste API</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/templates/dashboard.css">
</head>
<body>
    <div class="header">
        <h1>üéõÔ∏è Admin Dashboard</h1>
        <a href="/admin/logout" class="logout-btn">Logout</a>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">üìä Overview</button>
            <button class="tab" onclick="showTab('api-keys')">üîë API Keys</button>
            <button class="tab" onclick="showTab('endpoints')">üåê Endpoints</button>
            <button class="tab" onclick="showTab('users')">üë• Users</button>
            <button class="tab" onclick="showTab('logs')">üìã Logs</button>
            <button class="tab" onclick="showTab('database')">üíæ Database</button>
        </div>
        
        <div class="tab-content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-pane active">
                <h2 class="section-title">System Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="users-count">-</div>
                        <div class="stat-label">Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lists-count">-</div>
                        <div class="stat-label">Shopping Lists</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="categories-count">-</div>
                        <div class="stat-label">Categories</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">‚úÖ</div>
                        <div class="stat-label">API Status</div>
                    </div>
                </div>
                
                <h3 class="section-title">Database Information</h3>
                <p>Main Database: <span id="db-path">../backend/db.sqlite</span></p>
                <p>Database Size: <span id="db-size">-</span></p>
                <p>Last Modified: <span id="db-modified">-</span></p>
                
                <h3 class="section-title">Recent Activity</h3>
                <div id="recent-logs">Loading...</div>
            </div>
            
            <!-- API Keys Tab -->
            <div id="api-keys" class="tab-pane">
                <h2 class="section-title">API Key Management</h2>
                <button class="btn" onclick="showCreateApiKey()">+ Create New API Key</button>
                
                <!-- API Key Success Display -->
                <div id="api-key-success" style="display: none; margin-top: 20px; padding: 25px; background: #1a4a2e; border: 2px solid #4CAF50; border-radius: 10px;">
                    <h3 style="color: #4CAF50; margin-top: 0;">‚úÖ API Key Created Successfully!</h3>
                    
                    <div style="background: #0d1b0f; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <label style="color: #4CAF50; font-weight: bold; margin-bottom: 8px; display: block;">Your API Key:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="generated-api-key" readonly 
                                   style="flex: 1; font-family: monospace; background: #000; color: #4CAF50; border: 1px solid #4CAF50; padding: 12px; border-radius: 6px; font-size: 14px;">
                            <button class="btn" onclick="copyApiKey()" style="background: #2196F3; min-width: 100px;">
                                üìã Copy
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: #3d1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #f44336; margin: 15px 0;">
                        <strong style="color: #f44336;">‚ö†Ô∏è Important Security Notice:</strong>
                        <p style="margin: 8px 0 0 0; color: #ff9999;">This API key will never be shown again after you close this dialog. Please save it in a secure location immediately.</p>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button id="confirm-api-key-btn" class="btn btn-danger" onclick="confirmApiKeyReceived()" disabled style="position: relative; min-width: 200px;">
                            <span id="confirm-btn-text">I've saved the key securely (5)</span>
                        </button>
                    </div>
                </div>
                
                <div id="create-api-key" style="display: none; margin-top: 20px; padding: 20px; background: #1a1a1a; border-radius: 10px;">
                    <h3>Create New API Key</h3>
                    
                    <div class="form-group">
                        <label>Key Name:</label>
                        <input type="text" id="key-name" placeholder="Enter key name...">
                    </div>
                    
                    <div class="form-group">
                        <label>Expiration:</label>
                        <select id="key-expiration">
                            <option value="never">Never expires</option>
                            <option value="7">7 days</option>
                            <option value="30">30 days</option>
                            <option value="90">90 days</option>
                            <option value="365">1 year</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Endpoint Permissions:</label>
                        <div class="endpoints-loading" id="endpoints-loading">Loading endpoints...</div>
                        <div class="endpoints-grid" id="endpoints-grid" style="display: none;">
                            <!-- Endpoints will be loaded dynamically -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Rate Limit (requests per minute):</label>
                        <select id="rate-limit">
                            <option value="60">60 (Standard)</option>
                            <option value="120">120 (Medium)</option>
                            <option value="300">300 (High)</option>
                            <option value="600">600 (Premium)</option>
                            <option value="unlimited">Unlimited</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>IP Restrictions (optional):</label>
                        <input type="text" id="ip-restrictions" placeholder="e.g., 192.168.1.0/24, 10.0.0.1 (comma separated)">
                        <small style="color: #888; display: block; margin-top: 5px;">Leave empty for no IP restrictions</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Description (optional):</label>
                        <textarea id="key-description" placeholder="What will this key be used for?" rows="3"></textarea>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button class="btn" onclick="createApiKey()">Create API Key</button>
                        <button class="btn btn-danger" onclick="hideCreateApiKey()">Cancel</button>
                    </div>
                </div>
                
                <div id="api-keys-list">Loading...</div>
            </div>
            
            <!-- Endpoints Tab -->
            <div id="endpoints" class="tab-pane">
                <h2 class="section-title">API Endpoints Configuration</h2>
                <div id="endpoints-list">Loading...</div>
            </div>
            
            <!-- Users Tab -->
            <div id="users" class="tab-pane">
                <h2 class="section-title">User Management</h2>
                <div id="users-list">Loading...</div>
            </div>
            
            <!-- Logs Tab -->
            <div id="logs" class="tab-pane">
                <h2 class="section-title">System Logs</h2>
                <button class="btn btn-danger" onclick="clearLogs()">Clear All Logs</button>
                <div id="logs-list">Loading...</div>
            </div>
            
            <!-- Database Tab -->
            <div id="database" class="tab-pane">
                <h2 class="section-title">Database Management</h2>
                <div id="database-info">Loading...</div>
            </div>
        </div>
    </div>

    <!-- Modal for endpoint configuration -->
    <div id="endpoint-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2d2d2d; padding: 30px; border-radius: 10px; width: 80%; max-width: 600px; max-height: 80%; overflow-y: auto;">
            <h3>Configure Endpoint</h3>
            <div id="endpoint-config-content">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <script src="/templates/dashboard.js"></script>
</body>
</html>
