<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard - Einkaufsliste API</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/templates/dashboard.css">
</head>
<body>
    <div class="header">
        <h1>üéõÔ∏è Admin Dashboard</h1>
        <a href="/admin/logout" class="logout-btn">Logout</a>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">üìä Overview</button>
            <button class="tab" onclick="showTab('api-keys')">üîë API Keys</button>
            <button class="tab" onclick="showTab('endpoints')">üåê Endpoints</button>
            <button class="tab" onclick="showTab('users')">üë• Users</button>
            <button class="tab" onclick="showTab('logs')">üìã Logs</button>
            <button class="tab" onclick="showTab('database')">üíæ Database</button>
            <button class="tab" onclick="showTab('docs')">üìñ Docs</button>
            <button class="tab" onclick="showTab('labor')">üß™ Labor</button>
        </div>
        
        <div class="tab-content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-pane active">
                <h2 class="section-title">System Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="api-keys-count">-</div>
                        <div class="stat-label">API Keys</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="api-requests-count">-</div>
                        <div class="stat-label">API Requests (Today/Total)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="endpoints-count">-</div>
                        <div class="stat-label">Endpoints (Active/Total)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">‚úÖ</div>
                        <div class="stat-label">API Status</div>
                    </div>
                </div>
                
                <h3 class="section-title">Database Information</h3>
                <p>Main Database: <span id="db-path">../backend/db.sqlite</span></p>
                <p>Database Size: <span id="db-size">-</span></p>
                <p>Last Modified: <span id="db-modified">-</span></p>
                
                <h3 class="section-title">Recent Activity</h3>
                <div id="recent-logs">Loading...</div>
            </div>
            
            <!-- API Keys Tab -->
            <div id="api-keys" class="tab-pane">
                <h2 class="section-title">API Key Management</h2>
                <button class="btn" onclick="showCreateApiKey()">+ Create New API Key</button>
                
                <!-- API Key Success Display -->
                <div id="api-key-success" style="display: none; margin-top: 20px; padding: 25px; background: #1a4a2e; border: 2px solid #4CAF50; border-radius: 10px;">
                    <h3 style="color: #4CAF50; margin-top: 0;">‚úÖ API Key Created Successfully!</h3>
                    
                    <div style="background: #0d1b0f; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <label style="color: #4CAF50; font-weight: bold; margin-bottom: 8px; display: block;">Your API Key:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" id="generated-api-key" readonly 
                                   style="flex: 1; font-family: monospace; background: #000; color: #4CAF50; border: 1px solid #4CAF50; padding: 12px; border-radius: 6px; font-size: 14px;">
                            <button class="btn" onclick="copyApiKey()" style="background: #2196F3; min-width: 100px;">
                                üìã Copy
                            </button>
                        </div>
                    </div>
                    
                    <div style="background: #3d1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #f44336; margin: 15px 0;">
                        <strong style="color: #f44336;">‚ö†Ô∏è Important Security Notice:</strong>
                        <p style="margin: 8px 0 0 0; color: #ff9999;">This API key will never be shown again after you close this dialog. Please save it in a secure location immediately.</p>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button id="confirm-api-key-btn" class="btn btn-danger" onclick="confirmApiKeyReceived()" disabled style="position: relative; min-width: 200px;">
                            <span id="confirm-btn-text">I've saved the key securely (5)</span>
                        </button>
                    </div>
                </div>
                
                <div id="create-api-key" style="display: none; margin-top: 20px; padding: 20px; background: #1a1a1a; border-radius: 10px;">
                    <h3>Create New API Key</h3>
                    
                    <div class="form-group">
                        <label>Key Name:</label>
                        <input type="text" id="key-name" placeholder="Enter key name...">
                    </div>
                    
                    <div class="form-group">
                        <label>Expiration:</label>
                        <select id="key-expiration">
                            <option value="never">Never expires</option>
                            <option value="7">7 days</option>
                            <option value="30">30 days</option>
                            <option value="90">90 days</option>
                            <option value="365">1 year</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Endpoint Permissions:</label>
                        <div class="endpoints-loading" id="endpoints-loading">Loading endpoints...</div>
                        <div class="endpoints-grid" id="endpoints-grid" style="display: none;">
                            <!-- Endpoints will be loaded dynamically -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Rate Limit (requests per minute):</label>
                        <select id="rate-limit">
                            <option value="60">60 (Standard)</option>
                            <option value="120">120 (Medium)</option>
                            <option value="300">300 (High)</option>
                            <option value="600">600 (Premium)</option>
                            <option value="unlimited">Unlimited</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>IP Restrictions (optional):</label>
                        <input type="text" id="ip-restrictions" placeholder="e.g., 192.168.1.0/24, 10.0.0.1 (comma separated)">
                        <small style="color: #888; display: block; margin-top: 5px;">Leave empty for no IP restrictions</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Description (optional):</label>
                        <textarea id="key-description" placeholder="What will this key be used for?" rows="3"></textarea>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button class="btn" onclick="createApiKey()">Create API Key</button>
                        <button class="btn btn-danger" onclick="hideCreateApiKey()">Cancel</button>
                    </div>
                </div>
                
                <div id="api-keys-list">Loading...</div>
            </div>
            
            <!-- Endpoints Tab -->
            <div id="endpoints" class="tab-pane">
                <h2 class="section-title">API Endpoints Configuration</h2>
                <div id="endpoints-list">Loading...</div>
            </div>
            
            <!-- Users Tab -->
            <div id="users" class="tab-pane">
                <h2 class="section-title">User Management</h2>
                <div id="users-list">Loading...</div>
            </div>
            
            <!-- Logs Tab -->
            <div id="logs" class="tab-pane">
                <h2 class="section-title">System Logs</h2>
                <button class="btn btn-danger" onclick="clearLogs()">Clear All Logs</button>
                <div id="logs-list">Loading...</div>
            </div>
            
            <!-- Database Tab -->
            <div id="database" class="tab-pane">
                <h2 class="section-title">Database Management</h2>
                <div id="database-info">Loading...</div>
            </div>
            
            <!-- Documentation Tab -->
            <div id="docs" class="tab-pane">
                <h2 class="section-title">üìñ API Documentation</h2>
                
                <div class="docs-header">
                    <p>Complete documentation for all API endpoints with examples and detailed explanations.</p>
                    <div class="docs-actions">
                        <button class="btn" onclick="openPublicDocs()">üåê Open Public Documentation</button>
                        <button class="btn btn-secondary" onclick="refreshDocumentation()">üîÑ Refresh</button>
                    </div>
                </div>
                
                <div class="docs-overview">
                    <div class="docs-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="docs-endpoints-count">-</div>
                            <div class="stat-label">Total Endpoints</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="docs-categories-count">-</div>
                            <div class="stat-label">Categories</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="docs-last-updated">-</div>
                            <div class="stat-label">Last Updated</div>
                        </div>
                    </div>
                </div>
                
                <div class="docs-content">
                    <h3 class="subsection-title">üìã API Categories</h3>
                    <div id="docs-categories" class="docs-categories">
                        Loading documentation...
                    </div>
                    
                    <!-- Inline endpoint details section -->
                    <div id="endpoint-details-section" class="endpoint-details-section" style="display: none;">
                        <h3 class="subsection-title">üìÑ Endpoint Details</h3>
                        <div id="endpoint-details-content" class="endpoint-details-content">
                            <!-- Detailed endpoint information will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <div class="docs-quick-start">
                    <h3 class="subsection-title">üöÄ Quick Start</h3>
                    <div class="code-example">
                        <h4>Basic Authentication</h4>
                        <pre><code>curl -H "X-API-Key: YOUR_API_KEY" http://localhost:4200/api/stats</code></pre>
                    </div>
                    <div class="code-example">
                        <h4>Example Request</h4>
                        <pre><code>POST /api/articles
Content-Type: application/json
X-API-Key: YOUR_API_KEY

{
  "name": "Example Article",
  "category": "Electronics",
  "price": 99.99
}</code></pre>
                    </div>
                </div>
            </div>
            
            <!-- Labor Tab -->
            <div id="labor" class="tab-pane">
                <h2 class="section-title">üß™ Labor - Testing & Monitoring</h2>
                
                <!-- API Test Zone -->
                <div class="section">
                    <h3 class="subsection-title">üî¨ API Testzone</h3>
                    
                    <!-- Auth Section -->
                    <div class="test-section">
                        <h4>üîë Authentication</h4>
                        <div class="auth-controls">
                            <div class="api-key-selector">
                                <label>Select API Key:</label>
                                <select id="selected-api-key" onchange="loadSelectedKeyStats()">
                                    <option value="">No API Key Selected</option>
                                </select>
                                <button class="btn btn-secondary" onclick="refreshApiKeys()">üîÑ Refresh</button>
                            </div>
                            <div id="selected-key-stats" class="key-stats">
                                <p>Select an API key to see statistics</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Test Configuration -->
                    <div class="test-section">
                        <h4>üéØ Test Configuration</h4>
                        <div class="test-config">
                            <div class="endpoint-selection">
                                <label>Select Endpoints:</label>
                                <div id="endpoint-checkboxes" class="checkbox-grid">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                            <div class="test-type-selection">
                                <label>Test Type:</label>
                                <div class="test-type-options">
                                    <label><input type="radio" name="test-type" value="quick" checked> üöÄ Quick Check</label>
                                    <label><input type="radio" name="test-type" value="full"> üîç Full Check</label>
                                    <label><input type="radio" name="test-type" value="performance"> ‚ö° Performance Check</label>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="runApiTests()">‚ñ∂Ô∏è Run Tests</button>
                        </div>
                    </div>
                    
                    <!-- Test Results -->
                    <div class="test-section">
                        <h4>üìä Test Results</h4>
                        <div id="test-results" class="test-results">
                            <p>No tests run yet. Select endpoints and run tests to see results.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Backend Monitoring -->
                <div class="section">
                    <h3 class="subsection-title">üñ•Ô∏è Backend (Einkaufsliste)</h3>
                    <div class="monitoring-grid">
                        <div class="monitor-card">
                            <h4>üìä Status</h4>
                            <div id="backend-status" class="status-indicator">
                                <span class="status-dot green"></span>
                                <span>Running</span>
                            </div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚è±Ô∏è Uptime</h4>
                            <div id="backend-uptime" class="uptime-display">00:00:00</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üåê Google Ping</h4>
                            <div id="google-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚òÅÔ∏è Cloudflare Ping</h4>
                            <div id="cloudflare-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üîó Backend ‚Üî Frontend</h4>
                            <div id="backend-frontend-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚ö° AVG Response Time</h4>
                            <div id="backend-avg-response-time" class="ping-display">Calculating...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üìà Statistics</h4>
                            <div id="backend-stats" class="stats-display">
                                <div>Requests: <span id="total-requests">0</span></div>
                                <div>Errors: <span id="total-errors">0</span></div>
                                <div>Memory: <span id="memory-usage">N/A</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- API Backend Monitoring -->
                <div class="section">
                    <h3 class="subsection-title">‚öôÔ∏è Backend (API)</h3>
                    <div class="monitoring-grid">
                        <div class="monitor-card">
                            <h4>üìä Status</h4>
                            <div id="api-backend-status" class="status-indicator">
                                <span class="status-dot green"></span>
                                <span>Running</span>
                            </div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚è±Ô∏è Uptime</h4>
                            <div id="api-backend-uptime" class="uptime-display">00:00:00</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üåê Google Ping</h4>
                            <div id="api-google-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚òÅÔ∏è Cloudflare Ping</h4>
                            <div id="api-cloudflare-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚ö° AVG Response Time</h4>
                            <div id="api-avg-response-time" class="ping-display">Calculating...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üìà Statistics</h4>
                            <div id="api-backend-stats" class="stats-display">
                                <div>API Calls: <span id="api-total-requests">0</span></div>
                                <div>Errors: <span id="api-total-errors">0</span></div>
                                <div>Memory: <span id="api-memory-usage">N/A</span></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Frontend Monitoring -->
                <div class="section">
                    <h3 class="subsection-title">üåê Frontend (Einkaufsliste)</h3>
                    <div class="monitoring-grid">
                        <div class="monitor-card">
                            <h4>üìä Status</h4>
                            <div id="frontend-status" class="status-indicator">
                                <span class="status-dot yellow"></span>
                                <span>Checking...</span>
                            </div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚è±Ô∏è Uptime</h4>
                            <div id="frontend-uptime" class="uptime-display">00:00:00</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üåê Google Ping</h4>
                            <div id="frontend-google-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>‚òÅÔ∏è Cloudflare Ping</h4>
                            <div id="frontend-cloudflare-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üîó Frontend ‚Üî Backend</h4>
                            <div id="frontend-backend-ping" class="ping-display">Testing...</div>
                        </div>
                        <div class="monitor-card">
                            <h4>üìà Statistics</h4>
                            <div id="frontend-stats" class="stats-display">
                                <div>Page Views: <span id="page-views">0</span></div>
                                <div>Load Time: <span id="load-time">N/A</span></div>
                                <div>Status: <span id="frontend-health">Healthy</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for endpoint configuration -->
    <div id="endpoint-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #2d2d2d; padding: 30px; border-radius: 10px; width: 80%; max-width: 600px; max-height: 80%; overflow-y: auto;">
            <h3>Configure Endpoint</h3>
            <div id="endpoint-config-content">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>

    <script src="/templates/dashboard.js"></script>
    <script src="/templates/docs_functions.js"></script>
</body>
</html>
